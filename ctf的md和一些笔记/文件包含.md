#### 常见文件包含函数

+ `include()` :找不到被包含的文件时只会产生警告，脚本将继续运行。
+ `require()` :找不到被包含的文件时会产生致命错误，并停止脚本运行。
+ `include_once()` :与 `include()` 类似，唯一区别是如果该文件中的代码已经被包含，则不会再次包含。
+ `require_once()` :与 `require()` 类似，唯一区别是如果该文件中的代码已经被包含，则不会再次包含。
+ `fopen()`
+ `readfile()`

---

#### 文件包含协议

`file://`:

+ 用法：

```
file:///etc/passwd
file://C:/Windows/win.ini
```

+ 示例：

**file://[ 文件的绝对路径和文件名]**

```
http://127.0.0.1/?filename=file:///etc/passwd
```



`php://`

| 协议                    | 作用                                                         |
| ----------------------- | ------------------------------------------------------------ |
| php://input             | 可以访问请求的原始数据的只读流。 如果启用了 [enable_post_data_reading](https://www.php.net/manual/zh/ini.core.php#ini.enable-post-data-reading) 选项， php://input 在使用 `enctype="multipart/form-data"` 的 POST 请求中不可用。 |
| php://output            | 只写的数据流， 允许你以 [print](https://www.php.net/manual/zh/function.print.php) 和 [echo](https://www.php.net/manual/zh/function.echo.php) 一样的方式 写入到输出缓冲区。 |
| php://fd                | (>=5.3.6) php://fd 允许直接访问指定的文件描述符。 例如 php://fd/3 引用了文件描述符 3。 |
| php://memory php://temp | (>=5.1.0) 类似文件 包装器的数据流，允许读写临时数据。 两者的一个区别是 php://memory 总是把数据储存在内存中， 而 php://temp 会在内存量达到预定义的限制后（默认是 2MB）存入临时文件中。 临时文件位置的决定和 [sys_get_temp_dir()](https://www.php.net/manual/zh/function.sys-get-temp-dir.php) 的方式一致。php://temp 的内存限制可通过添加 `/maxmemory:NN` 来控制，`NN` 是以字节为单位、保留在内存的最大数据量，超过则使用临时文件。 |
| php://filter            | (>=5.0.0) 元封装器， 设计用于数据流打开时的[筛选过滤](https://www.php.net/manual/zh/filters.php)应用。 这对于一体式（all-in-one）的文件函数非常有用，类似 [readfile()](https://www.php.net/manual/zh/function.readfile.php)、 [file()](https://www.php.net/manual/zh/function.file.php) 和 [file_get_contents()](https://www.php.net/manual/zh/function.file-get-contents.php)， 在数据流内容读取之前没有机会应用其他过滤器。 |

**php://filter 参数详解**

| 名称                        | 描述                                                         |
| :-------------------------- | :----------------------------------------------------------- |
| `resource=<要过滤的数据流>` | 这个参数是必须的。它指定了你要筛选过滤的数据流。             |
| `read=<读链的筛选列表>`     | 该参数可选。可以设定一个或多个过滤器名称，以管道符（`|`）分隔。 |
| `write=<写链的筛选列表>`    | 该参数可选。可以设定一个或多个过滤器名称，以管道符（`|`）分隔。 |
| `<；两个链的筛选列表>`      | 任何没有以 `read=` 或 `write=` 作前缀 的筛选器列表会视情况应用于读或写链。 |



`data://`

*自 `PHP>=5.2.0` 起，可以使用 `data://` 数据流封装器，以传递相应格式的数据。通常可以用来执行 PHP 代码。*

**用法**：

```
data://text/plain,<?php phpinfo();
data://text/plain;base64,[Base64编码后的代码]
```

---

#### 条件竞争

**原理：当我们成功上传了php文件，服务端会在短时间内将其删除，我们需要抢在它删除之前访问文件并生成一句话木马文件，所以访问包的线程需要大于上传包的线程。**

这个知识点在文件上传、不死马利用与查杀这些里面会涉及
